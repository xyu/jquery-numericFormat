/*
 * jQuery Numeric Format Plugin
 * http://github.com/xyu/jquery-numericFormat
 *
 * Copyright (c) 2010 Xiao Yu, @HypertextRanch
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(a){var b={addCommas:/(\d+)(\d{3})/,getPrecision:/\bprecision-(\d*)/},c={init:function(b){return this.each(function(){var d=a(this),e=d.data("numericFormat");e||d.data("numericFormat",a.extend({precision:2,_lockRedraw:!1,_colIndex:[]},b)),c._redraw(d),c._bindEvents(d)})},_bindEvents:function(a){var b=a.data("numericFormat");a.bind("DOMSubtreeModified.numericFormat",function(){b._lockRedraw||c._redraw(a)})},_redraw:function(b){var d=b.data("numericFormat");d._lockRedraw=!0,c._reindex(b),b.find("tr:visible").each(function(){a(this).find("td").each(function(b){if(d._colIndex[b]!==!1){var e=a(this);if(e.find("span.numericFormat-cell").length==1)return;var f=parseFloat(e.text());e.addClass("numeric"),isNaN(f)?e.html(c._addSpan("&nbsp;","numericFormat-cell")):e.html(c._formatFloat(f,d._colIndex[b]))}})}),setTimeout(function(){d._lockRedraw=!1},500)},_reindex:function(c){var d=c.data("numericFormat");d._colIndex=[],c.find("thead:first tr:last th").each(function(){var c=a(this),e=!1;if(c.hasClass("numeric")){e=d.precision;var f=c.attr("class").match(b.getPrecision);f!=undefined&&f.length==2&&(e=f[1])}d._colIndex.push(e)})},_formatFloat:function(a,b){var d=""+Math.abs(Math.round(a*Math.pow(10,b)));if(d.length>b)var e=d.substr(0,d.length-b),f=d.substr(-b);else var e="0",f=c._genString("0",b-d.length)+d;if(d=="0")var g="zero";else if(a<0)var g="neg";else var g="pos";if(b==0)var h=c._wrapParentheses(c._addCommas(e));else var h=c._wrapParentheses(c._addCommas(e)+"."+f);return c._addSpan(h,"numericFormat-cell "+g)},_genString:function(a,b){var c="";for(var d=0;d<b;d++)c+=a;return c},_wrapParentheses:function(a){return c._addSpan("( ","parentheses")+a+c._addSpan(" )","parentheses")},_addSpan:function(a,b){return"<span class=\""+b+"\">"+a+"</span>"},_addCommas:function(a){while(b.addCommas.test(a))a=a.replace(b.addCommas,"$1,$2");return a}};a.fn.numericFormat=function(){return c.init.apply(this,arguments)}})(jQuery)